from aiogram import Bot, Dispatcher, types, F
from aiogram.filters import Command
from aiogram.types import WebAppInfo, MenuButtonWebApp
from aiogram.enums import ParseMode
import asyncio

BOT_TOKEN = "–í–ê–®_–¢–û–ö–ï–ù_–û–¢_@BOTFATHER"
WEBAPP_URL = "https://–≤–∞—à-–Ω–∏–∫.github.io/neurofitness-mindmap/"

bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()

@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    keyboard = types.InlineKeyboardMarkup(inline_keyboard=[
        [types.InlineKeyboardButton(
            text="üß† –û—Ç–∫—Ä—ã—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ä—Ç—É",
            web_app=WebAppInfo(url=WEBAPP_URL)
        )],
        [
            types.InlineKeyboardButton(text="üìã –¢–µ–ª–æ", callback_data="block_body"),
            types.InlineKeyboardButton(text="üß† –ú–æ–∑–≥", callback_data="block_brain")
        ],
        [
            types.InlineKeyboardButton(text="üë®‚Äçüè´ –¢—Ä–µ–Ω–µ—Ä", callback_data="block_trainer"),
            types.InlineKeyboardButton(text="‚ùì –ü–æ–º–æ—â—å", callback_data="help")
        ]
    ])
    
    await message.answer(
        "üéØ <b>NeuroFitness Mindmap</b>\n\n"
        "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –≤—Å–µ—Ö —Å–µ–º–∏–Ω–∞—Ä–æ–≤ –∏ –∫—É—Ä—Å–æ–≤.\n\n"
        "<b>–¢—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –±–ª–æ–∫–∞:</b>\n"
        "üü† <b>–ö–≤–µ—Å—Ç –ø–æ —Ç–µ–ª—É</b> ‚Äî —Ñ–∞—Å—Ü–∏—è, –∞–Ω–∞—Ç–æ–º–∏—è, –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å\n"
        "üü£ <b>–ö–≤–µ—Å—Ç –ø–æ –º–æ–∑–≥—É</b> ‚Äî –Ω–µ–π—Ä–æ—Ñ–∏—Ç–Ω–µ—Å, –Ω–µ–π—Ä–æ—Å–∫—Ä–∏–Ω–∏–Ω–≥\n"
        "üü¢ <b>–¢—Ä–µ–Ω–µ—Ä –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è</b> ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ\n\n"
        "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è üëá",
        parse_mode=ParseMode.HTML,
        reply_markup=keyboard
    )

@dp.callback_query(F.data.startswith("block_"))
async def block_callback(callback: types.CallbackQuery):
    block = callback.data.split("_")[1]
    names = {
        "body": ("üü† –ö–≤–µ—Å—Ç –ø–æ —Ç–µ–ª—É", "–§–∞—Å—Ü–∏—è, —Ç–æ–ø–æ–≥—Ä–∞—Ñ–∏—è, –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å, —Ç–µ–π–ø–∏—Ä–æ–≤–∞–Ω–∏–µ"),
        "brain": ("üü£ –ö–≤–µ—Å—Ç –ø–æ –º–æ–∑–≥—É", "–ù–µ–π—Ä–æ—Ñ–∏—Ç–Ω–µ—Å, –≤–µ—Å—Ç–∏–±—É–ª—è—Ä–∫–∞, –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞ 2.0"),
        "trainer": ("üü¢ –¢—Ä–µ–Ω–µ—Ä –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è", "–ü—Ä–æ—Ñ–µ—Å—Å–∏—è, —Å–∏–ª–æ–≤–æ–π —Ç—Ä–µ–Ω–∏–Ω–≥, –∑–¥–æ—Ä–æ–≤—å–µ")
    }
    name, desc = names.get(block, ("–ë–ª–æ–∫", "–û–ø–∏—Å–∞–Ω–∏–µ"))
    
    await callback.message.edit_text(
        f"{name}\n\n{desc}\n\n–û—Ç–∫—Ä–æ–π—Ç–µ mindmap –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:",
        reply_markup=types.InlineKeyboardMarkup(inline_keyboard=[
            [types.InlineKeyboardButton(
                text="üß† –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É", 
                web_app=WebAppInfo(url=WEBAPP_URL)
            )],
            [types.InlineKeyboardButton(text="‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data="back")]
        ])
    )

@dp.callback_query(F.data == "back")
async def back_callback(callback: types.CallbackQuery):
    await cmd_start(callback.message)

@dp.callback_query(F.data == "help")
async def help_callback(callback: types.CallbackQuery):
    await callback.answer(
        "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:\n"
        "‚Ä¢ –¢–∞–ø –ø–æ –∫—Ä—É–≥—É ‚Äî —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å/—Å–≤–µ—Ä–Ω—É—Ç—å\n"
        "‚Ä¢ –ü–∏–Ω—á ‚Äî –∑—É–º\n"
        "‚Ä¢ –°–≤–∞–π–ø ‚Äî –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ\n"
        "‚Ä¢ –ö–Ω–æ–ø–∫–∏ —Å–Ω–∏–∑—É ‚Äî –±—ã—Å—Ç—Ä—ã–π —Ñ–∏–ª—å—Ç—Ä",
        show_alert=True
    )

async def main():
    await bot.set_chat_menu_button(
        menu_button=MenuButtonWebApp(
            text="üß† Mindmap",
            web_app=WebAppInfo(url=WEBAPP_URL)
        )
    )
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
